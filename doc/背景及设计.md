# 项目背景

很多产品、服务、平台等向外步提供 API 的时候，都通过文档中心、开发者中心、API 说明等网站形式。
这种网站形式，所提供API说明都由很多的网页页面组成，如果需要大模型参考这些API页面就很不方便。
我要开发一个工具，解决大模型读取一个产品或者服务的API文档所面临的问题。

# 实现方式

实现方式是将一个产品（或者服务，下同）的API网站的所有API接入开发相关的网页页面内容提取并生成到一个《单文件完整API文档》文件中，这样就很方便将这个文件提供给大模型，基于此文件，大模型可以更好的回答用户提出的API问题，或者基于用户需求生成API相关的代码。

为了减轻人力手工成本，提高效率，我采用了将API网页采集到本地，让大模型帮分析网页的内容，最终生成一个《单文件完整API文档》文件的实现方式。

因为大模型输出Token的数量是有限的，而一个产品的API文档页面可能是很多很多的，直接让大模型读取一个产品所有的API网页内容并一次性生成一个《单文件完整API文档》是不现实的。所以下面的实现方式步骤中，采用了提取任务、分布执行的方式。

## 第一步：爬取API页面

根据用户提供的API文档的网址，通过爬虫的方式获取所有API文档页面并保存html文件内容，形成了site_pages这样一张数据表，字段有：
product_id(允许处理不同产品的API文档),
html_page_url（api 页面url）、page_title（页面标题）、html_code（页面html源码）、page_id（数据库自增Id）、extracted_content(
大模型从html文件中提取的内容，此字段在第二步使用)

## 第二步：逐个解析API页面内容

循环一个产品的site_pages记录,将 html 文件的源码提供给大模型，并向大模型说明项目背景，请大模型从此html源码中与任务相关的内容，存储到site_page的extracted_content字段。

## 第三步：合并所有已解析单个HTML内容成为一个完整MD文档

循环这个产品的site_pages记录，每一条记录（代表了一个API网页页面）的所有字段形成一个md格式的文本块儿，最后将所有的md文本块连接形成一个《单文件API素材文件》。

## 第四步：提取通用部分任务

调用大模型，提供项目背景、《单文件API素材文件》请大模型提取提取API文档的通用部分，比如包括但不限于授权方式、分页方式、HTTP状态码等（请注意这里只是举例），让大模型生成一个《API通用部分内容生成任务列表》，以json格式返回这个列表。以便程序代码可以解析这个json，并逐个执行里面的任务。

## 第五步：执行通用部分任务

解析《API通用部分内容生成任务列表》这个json文件，循环每条任务，逐个任务的，将项目背景、任务标题、《单文件API素材文件》都提供给大模型，请大模型根据这个任务生成《单文件完整API文档》所需要的内容。

## 第六步：提取Api列表部分任务

调用大模型，提供项目背景、《单文件API素材文件》请大模型提取提取API文档的通用部分，让大模型生成一个《API接口部分内容生成任务列表》，以json格式返回这个列表。以便程序代码可以解析这个json，并逐个执行里面的任务。

## 第七步：执行Api列表部分任务

解析《API接口部分内容生成任务列表》这个json文件，循环每条任务，逐个任务的，将项目背景、任务标题、《单文件API素材文件》都提供给大模型，请大模型根据这个任务生成《单文件完整API文档》所需要的内容。

## 第八步：合并所有的任务生成结果

通过程序将所有生成的内容合并并生成一个《单文件完整API文档》文件。
